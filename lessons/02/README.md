## 02. Индексы

---
### Домашнее задание

- Проводим анализ возможных запросов\отчетов\поиска данных.
- Предполагаем возможную кардинальность поля.
- Создаем дополнительные индексы - простые или композитные.
- На каждый индекс пишем краткое описание зачем он нужен (почему по этому полю\полям).
- Думаем какие логические ограничения в БД нужно добавить - например какие поля должны быть уникальны, в какие нужно добавить условия, чтобы не нарушить бизнес логику. Пример - нельзя провести операцию по переводу средств на отрицательную сумму.
- Создаем ограничения по выбранным полям.
---

#### Возможные запросы на поиск информации:

Поиск фильмов и актеров ожидается как наиболее частый среди пользователей

- поиск фильмов по названию (рус),  по жанрам,  по рейтингу, по актерам, режиссерам
- поиск информации по статьям, обзорам, анонсам, ..
- поиск актеров, режиссеров
- поиск фильмов по подборкам (tags), по номинациям и наградам
- поиск награждений по номинациям

Поиск данных для внутренноего использования 

- сбор статистики по просмотрам, жанрам, странам, актерам, рейтингам, подборки,..
- сбор статистики по посещаемости каталога
- сбор статистики по выходу новых фильмов
- сбор статистики просмотров, рейтингу фильмов по онлайн-кинотеатрам
- сбор статистики по отзывам пользователей
- сбор информации по кассовой выручке проката

#### Возможная кардинальность поля

Кардинальность полей в таблице `movie`:

- наибольшая:   title, title_original, budget, boxoffice (неограниченная вариативность названий и сумм), duration 
  (есть верхние и нижние границы продолжительности, но редки совпадения)
- усредненная:  release_year(на каждый год несколько фильмов), country (фиксированное кол-во)
- наименьшая:   rars, rating (обусловлена фиксированным количеством вариантов)

Кардинальность полей в таблице `publications`:

- наибольшая: title
- средняя: author
- наименьшая: category

#### Дополнительные Индексы

- `movie`: 
  - **title**: основной поиск 
  - **title_original**: поиск по оригинальному названию, реже 
  - **rating**: фильтр по рейтингу
- `publications`: 
  - **title**: основной поиск
  - **text**: (полнотекстовый поиск)
  - **create_day**: фильтр или поиск на определенную дату, за период
- `user`:
  - **fio**: поиск автора публикаций или комментария
- `person`:
  - (**last_name**, **first_name**): поиск по фамилии, имени (у поля last_name кардинальность выше-фамилий больше чем имен)
- `award_ceremony`:
  - **title**: поиск по наименованию церемонии

#### Ограничения по полям и таблицам

- `users_rating`
  - ограничение на значение рейтинга - от 1 до 5
  - так как в таблице учитывается рейтинг на фильмы и публикации - ограничение (проверка) на рейтинг без указания 
    фильма или публикации или одновременное указание обоих категорий
  - уникальность полей (user, movie_id, publication_id) - один "голос" на предмет оценки
- `user_movie_orders`
  - уникальность полей (user, movie_id, publication_id) - один заказ на фильм в одном кинотеатре
- `tag_m2m`
  - уникальность полей (tag_title, movie_id) - одна метка к фильму
  - уникальность полей (tag_title, publication_id) - одна метка к публикации
- `publication_category`
  - уникальность поля (title) - уникальный категории #todo первичный ключ
- `place`
  - уникальность (title, city_id, postcode, street, build, office)
- `movie_rars` (возрастное ограничение)
  - check (min_age>0, min_age<22)
- `movie_genre_m2m`
  - уникальность (genre_id, movie_id) - исключить повторяемость жанра к фильму
- `movie`
  - проверка (rating>0, rating<6) - пользовательский рейтинг фильма в диапазоне от 1 до 6
  - проверка (duration>0)
  - проверка (budget>=0)
  - проверка (boxoffice>=0)
- `genre`
  - уникальность (title)
- `comments`
  - проверка на принадлежность комментария только к одной категории
- `cinema_online_movie_presence`
  - проверка (rating>0 and rating <6)
  - уникальность (movie_id, cinema_id) 
- `cinema_online`
  - уникальность (title) 
- `award_nomination`
  - уникальность (title) 
